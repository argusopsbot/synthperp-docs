<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SynthPerp DEX ‚Äî Architecture & Liquidity Flow</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0a0b10; color: #e0e0e0; font-family: 'Inter', -apple-system, sans-serif; overflow-x: hidden; }

  .header { text-align: center; padding: 40px 20px 20px; }
  .header h1 { font-size: 32px; font-weight: 700; background: linear-gradient(135deg, #00d4ff, #7b61ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .header p { color: #888; margin-top: 8px; font-size: 14px; }
  .header .chain { display: inline-block; margin-top: 12px; padding: 6px 16px; border-radius: 20px; background: rgba(0,212,255,0.1); border: 1px solid rgba(0,212,255,0.3); color: #00d4ff; font-size: 13px; font-weight: 500; }

  .legend { display: flex; justify-content: center; gap: 24px; padding: 16px 20px; flex-wrap: wrap; }
  .legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #999; }
  .legend-dot { width: 12px; height: 12px; border-radius: 3px; }

  .tabs { display: flex; justify-content: center; gap: 8px; padding: 10px 20px 20px; }
  .tab { padding: 8px 20px; border-radius: 8px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #999; cursor: pointer; font-size: 13px; transition: all 0.2s; }
  .tab.active { background: rgba(0,212,255,0.15); border-color: #00d4ff; color: #00d4ff; }
  .tab:hover { background: rgba(255,255,255,0.08); }

  .diagram { display: none; max-width: 1200px; margin: 0 auto; padding: 0 20px 60px; }
  .diagram.active { display: block; }

  svg { width: 100%; height: auto; }

  /* Contract boxes */
  .contract { cursor: pointer; transition: transform 0.15s; }
  .contract:hover { transform: scale(1.03); }
  .contract rect { transition: all 0.2s; }
  .contract:hover rect { filter: brightness(1.3); }

  /* Tooltip */
  .tooltip { position: fixed; display: none; background: #1a1d28; border: 1px solid rgba(255,255,255,0.15); border-radius: 10px; padding: 16px 20px; max-width: 380px; z-index: 100; box-shadow: 0 8px 32px rgba(0,0,0,0.5); }
  .tooltip h3 { font-size: 15px; font-weight: 600; margin-bottom: 6px; }
  .tooltip p { font-size: 12px; color: #aaa; line-height: 1.6; }
  .tooltip .addr { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: #666; margin-top: 8px; word-break: break-all; }
  .tooltip .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; margin-right: 4px; }

  /* Info cards */
  .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; max-width: 1200px; margin: 20px auto; padding: 0 20px; }
  .info-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 20px; }
  .info-card h3 { font-size: 14px; font-weight: 600; margin-bottom: 10px; }
  .info-card ul { list-style: none; }
  .info-card li { font-size: 12px; color: #999; padding: 3px 0; }
  .info-card li::before { content: '‚Üí '; color: #00d4ff; }

  .section-title { text-align: center; font-size: 20px; font-weight: 600; margin: 40px 0 20px; color: #fff; }

  /* Pair table */
  .pair-grid { max-width: 1200px; margin: 0 auto 40px; padding: 0 20px; }
  .pair-grid table { width: 100%; border-collapse: collapse; }
  .pair-grid th { text-align: left; padding: 10px 12px; font-size: 12px; font-weight: 600; color: #666; border-bottom: 1px solid rgba(255,255,255,0.1); text-transform: uppercase; letter-spacing: 0.5px; }
  .pair-grid td { padding: 8px 12px; font-size: 13px; border-bottom: 1px solid rgba(255,255,255,0.04); }
  .pair-grid tr:hover { background: rgba(255,255,255,0.02); }
  .cat-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; }
  .cat-fx { background: rgba(0,212,255,0.15); color: #00d4ff; }
  .cat-metal { background: rgba(255,183,0,0.15); color: #ffb700; }
  .cat-energy { background: rgba(255,100,50,0.15); color: #ff6432; }
  .cat-crypto { background: rgba(123,97,255,0.15); color: #7b61ff; }
  .cat-stock { background: rgba(0,255,136,0.15); color: #00ff88; }
  .cat-index { background: rgba(255,0,128,0.15); color: #ff0080; }

  /* Fee flow */
  .fee-flow { max-width: 800px; margin: 20px auto; padding: 0 20px; }
  .fee-bar { display: flex; border-radius: 8px; overflow: hidden; height: 36px; margin: 10px 0; }
  .fee-segment { display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; }

  @media (max-width: 768px) {
    .header h1 { font-size: 22px; }
    .info-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="header">
  <h1>SynthPerp DEX</h1>
  <p>Decentralized Synthetic Perpetual Futures Protocol</p>
  <div class="chain">‚¨° Base Sepolia (Chain 84532) ¬∑ Pyth Network Oracles ¬∑ USDC Collateral</div>
</div>

<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:#00d4ff;"></div> Core Engine</div>
  <div class="legend-item"><div class="legend-dot" style="background:#7b61ff;"></div> Periphery</div>
  <div class="legend-item"><div class="legend-dot" style="background:#00ff88;"></div> Account Layer</div>
  <div class="legend-item"><div class="legend-dot" style="background:#ffb700;"></div> Oracle</div>
  <div class="legend-item"><div class="legend-dot" style="background:#ff4466;"></div> Safety / Risk</div>
  <div class="legend-item"><div class="legend-dot" style="background:#888;"></div> Config / Storage</div>
</div>

<div class="tabs">
  <div class="tab active" onclick="showTab('architecture')">üèó Architecture</div>
  <div class="tab" onclick="showTab('liquidity')">üíß Liquidity Flow</div>
  <div class="tab" onclick="showTab('trading')">üìà Trade Lifecycle</div>
  <div class="tab" onclick="showTab('pairs')">üåê Trading Pairs</div>
  <div class="tab" onclick="showTab('fees')">üí∞ Fee Distribution</div>
  <div class="tab" onclick="showTab('addresses')">üìã Addresses</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ARCHITECTURE TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="diagram active" id="architecture">
<style>
  .arch-layer { border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 18px 20px 14px; margin-bottom: 12px; position: relative; }
  .arch-layer-title { position: absolute; top: -10px; left: 20px; background: #0a0b10; padding: 0 10px; font-size: 11px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
  .arch-cards { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
  .arch-card { background: rgba(255,255,255,0.03); border: 1.5px solid; border-radius: 10px; padding: 14px 18px; min-width: 160px; text-align: center; cursor: pointer; transition: all 0.2s; }
  .arch-card:hover { transform: translateY(-2px); filter: brightness(1.3); }
  .arch-card h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
  .arch-card p { font-size: 10px; color: #777; margin: 0; }
  .arch-card .fn { font-size: 9px; color: #555; margin-top: 6px; font-family: 'JetBrains Mono', monospace; }

  .arch-flow { display: flex; align-items: center; justify-content: center; gap: 6px; padding: 6px 0; flex-wrap: wrap; }
  .arch-arrow { font-size: 18px; line-height: 1; }
  .arch-flow-label { font-size: 10px; padding: 3px 10px; border-radius: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); }

  .arch-connector { text-align: center; padding: 4px 0; }
  .arch-connector .arrow-down { display: inline-block; width: 2px; height: 20px; position: relative; }
  .arch-connector .arrow-down::after { content: '‚ñº'; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); font-size: 10px; }

  .arch-side-label { font-size: 9px; color: #555; text-align: center; margin-top: 2px; }
</style>

<!-- LAYER 1: EXTERNAL (TOP) -->
<div class="arch-layer" style="border-color: rgba(255,255,255,0.12);">
  <div class="arch-layer-title" style="color: #888;">EXTERNAL ACTORS</div>
  <div class="arch-cards">
    <div class="arch-card" style="border-color: #555;"><h4 style="color:#ddd;">ü¶ä Trader</h4><p>MetaMask wallet</p></div>
    <div class="arch-card" style="border-color: #555;"><h4 style="color:#ddd;">üåê Frontend</h4><p>Lovable / Vercel</p></div>
    <div class="arch-card" style="border-color: #555;"><h4 style="color:#ddd;">üí∞ LP Provider</h4><p>Deposits USDC</p></div>
    <div class="arch-card" style="border-color: #555;"><h4 style="color:#ddd;">ü§ñ Keeper Bot</h4><p>Liquidations &amp; orders</p></div>
    <div class="arch-card" style="border-color: #555;"><h4 style="color:#ddd;">üè¶ Treasury</h4><p>Protocol revenue</p></div>
    <div class="arch-card" style="border-color: #ffb700;"><h4 style="color:#ffb700;">üîÆ Pyth Network</h4><p>Price feeds</p></div>
  </div>
</div>

<!-- FLOW ARROW -->
<div class="arch-flow">
  <span class="arch-flow-label" style="color:#00ff88;">Trader signs TX</span>
  <span class="arch-arrow" style="color:#00ff88;">‚Üì</span>
  <span class="arch-flow-label" style="color:#00d4ff;">LP deposits USDC</span>
  <span class="arch-arrow" style="color:#00d4ff;">‚Üì</span>
  <span class="arch-flow-label" style="color:#ff4466;">Keeper liquidates</span>
  <span class="arch-arrow" style="color:#ff4466;">‚Üì</span>
  <span class="arch-flow-label" style="color:#ffb700;">Pyth prices</span>
  <span class="arch-arrow" style="color:#ffb700;">‚Üì</span>
</div>

<!-- LAYER 2: ACCOUNT -->
<div class="arch-layer" style="border-color: rgba(0,255,136,0.2); background: rgba(0,255,136,0.02);">
  <div class="arch-layer-title" style="color: #00ff88;">ACCOUNT LAYER</div>
  <div class="arch-cards">
    <div class="arch-card contract" data-info="account-factory" style="border-color: #00ff88;"><h4 style="color:#00ff88;">AccountFactory</h4><p>Creates per-user accounts</p><div class="fn">createAccount() ‚Üí MarginAccount</div></div>
    <div class="arch-card contract" data-info="margin-account" style="border-color: #00ff88;"><h4 style="color:#00ff88;">MarginAccount</h4><p>Per-user wallet ¬∑ Sub-accounts</p><div class="fn">deposit() ¬∑ openPosition() ¬∑ withdraw()</div></div>
    <div class="arch-card contract" data-info="session-manager" style="border-color: #00ff88;"><h4 style="color:#00ff88;">SessionManager</h4><p>1-click trading ¬∑ Key delegation</p><div class="fn">createSession() ¬∑ validateSession()</div></div>
  </div>
</div>

<!-- FLOW ARROW -->
<div class="arch-flow">
  <span class="arch-flow-label" style="color:#00ff88;">MarginAccount calls Router</span>
  <span class="arch-arrow" style="color:#7b61ff;">‚Üì</span>
  <span class="arch-flow-label" style="color:#7b61ff;">openPositionFor(account, ...)</span>
</div>

<!-- LAYER 3: PERIPHERY -->
<div class="arch-layer" style="border-color: rgba(123,97,255,0.2); background: rgba(123,97,255,0.02);">
  <div class="arch-layer-title" style="color: #7b61ff;">PERIPHERY ‚Äî ENTRY POINTS</div>
  <div class="arch-cards">
    <div class="arch-card contract" data-info="router" style="border-color: #7b61ff; min-width: 220px;"><h4 style="color:#7b61ff;">Router ‚≠ê</h4><p>Primary trade entry ¬∑ USDC transfer ¬∑ Price updates</p><div class="fn">openPosition() ¬∑ closePosition() ¬∑ openPositionFor()</div></div>
    <div class="arch-card contract" data-info="order-book" style="border-color: #7b61ff;"><h4 style="color:#7b61ff;">OrderBook</h4><p>Limit orders ¬∑ Trigger prices</p><div class="fn">createOrder() ¬∑ executeOrder()</div></div>
  </div>
</div>

<!-- FLOW ARROW -->
<div class="arch-flow">
  <span class="arch-flow-label" style="color:#7b61ff;">Router calls PositionManager</span>
  <span class="arch-arrow" style="color:#00d4ff;">‚Üì</span>
  <span class="arch-flow-label" style="color:#00d4ff;">USDC goes to Vault</span>
  <span class="arch-arrow" style="color:#00d4ff;">‚Üì</span>
  <span class="arch-flow-label" style="color:#ffb700;">getPrice() from Oracle</span>
</div>

<!-- LAYER 4: CORE ENGINE -->
<div class="arch-layer" style="border-color: rgba(0,212,255,0.2); background: rgba(0,212,255,0.02);">
  <div class="arch-layer-title" style="color: #00d4ff;">CORE ENGINE</div>
  <div class="arch-cards">
    <div class="arch-card contract" data-info="position-manager" style="border-color: #00d4ff; min-width: 240px;"><h4 style="color:#00d4ff;">PositionManager ‚≠ê</h4><p>Open ¬∑ Close ¬∑ PnL calc ¬∑ Spread ¬∑ Fees</p><div class="fn">openPosition() ¬∑ closePosition() ¬∑ getPositionPnL()</div></div>
    <div class="arch-card contract" data-info="vault" style="border-color: #00d4ff; min-width: 220px;"><h4 style="color:#00d4ff;">Vault (ERC4626) ‚≠ê</h4><p>LP pool ¬∑ spVault shares ¬∑ 80% max util</p><div class="fn">deposit() ¬∑ reserveLiquidity() ¬∑ settlePnL()</div></div>
    <div class="arch-card contract" data-info="funding-rate" style="border-color: #00d4ff;"><h4 style="color:#00d4ff;">FundingRate</h4><p>OI tracking ¬∑ Skew-based rates</p><div class="fn">updateFunding() ¬∑ increaseOI() ¬∑ decreaseOI()</div></div>
  </div>
  <div style="display:flex; justify-content:center; gap: 20px; margin-top: 12px;">
    <div class="arch-card contract" data-info="usdc" style="border-color: rgba(0,212,255,0.3); border-style: dashed; min-width: 140px;"><h4 style="color:#00d4ff; font-size:12px;">USDC (ERC20)</h4><p>Sole collateral ¬∑ 6 decimals</p></div>
  </div>
</div>

<!-- FLOW ARROWS ‚Äî split into two paths -->
<div style="display: flex; justify-content: center; gap: 40px; padding: 6px 0;">
  <div class="arch-flow">
    <span class="arch-flow-label" style="color:#ffb700;">Oracle reads</span>
    <span class="arch-arrow" style="color:#ffb700;">‚Üí</span>
  </div>
  <div class="arch-flow">
    <span class="arch-flow-label" style="color:#7b61ff;">Fees (0.15%)</span>
    <span class="arch-arrow" style="color:#7b61ff;">‚Üì</span>
  </div>
  <div class="arch-flow">
    <span class="arch-flow-label" style="color:#ff4466;">Liquidation checks</span>
    <span class="arch-arrow" style="color:#ff4466;">‚Üì</span>
  </div>
</div>

<!-- SIDE-BY-SIDE: ORACLE + SAFETY + FEES -->
<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">

  <!-- ORACLE -->
  <div class="arch-layer" style="border-color: rgba(255,183,0,0.2); background: rgba(255,183,0,0.02);">
    <div class="arch-layer-title" style="color: #ffb700;">ORACLE &amp; CONFIG</div>
    <div style="display:flex; flex-direction:column; gap:10px;">
      <div class="arch-card contract" data-info="oracle" style="border-color: #ffb700;"><h4 style="color:#ffb700;">PriceAggregator</h4><p>Pyth Network ¬∑ Mock fallback</p><div class="fn">getPrice() ¬∑ updatePriceFeeds()</div></div>
      <div class="arch-card contract" data-info="pair-config" style="border-color: #888;"><h4 style="color:#ccc;">PairConfig</h4><p>56 pairs ¬∑ Leverage ¬∑ OI caps</p><div class="fn">getPairInfo() ¬∑ setOICaps()</div></div>
    </div>
  </div>

  <!-- SAFETY -->
  <div class="arch-layer" style="border-color: rgba(255,68,102,0.2); background: rgba(255,68,102,0.02);">
    <div class="arch-layer-title" style="color: #ff4466;">SAFETY &amp; RISK</div>
    <div style="display:flex; flex-direction:column; gap:10px;">
      <div class="arch-card contract" data-info="liquidation" style="border-color: #ff4466;"><h4 style="color:#ff4466;">LiquidationEngine</h4><p>1% maint. margin ¬∑ Keeper rewards</p><div class="fn">liquidate() ‚Üí InsuranceFund ‚Üí ADL</div></div>
      <div class="arch-card contract" data-info="auto-deleverage" style="border-color: #ff4466;"><h4 style="color:#ff4466;">AutoDeleverage</h4><p>Last resort ¬∑ Force-close profitable</p><div class="fn">executeADL() when util &gt; 90%</div></div>
    </div>
  </div>

  <!-- FEES -->
  <div class="arch-layer" style="border-color: rgba(123,97,255,0.2); background: rgba(123,97,255,0.02);">
    <div class="arch-layer-title" style="color: #7b61ff;">FEE &amp; INSURANCE</div>
    <div style="display:flex; flex-direction:column; gap:10px;">
      <div class="arch-card contract" data-info="fee-distributor" style="border-color: #7b61ff;"><h4 style="color:#7b61ff;">FeeDistributor</h4><p>60% Treasury ¬∑ 30% Vault ¬∑ 10% Insurance</p><div class="fn">distributeFees()</div></div>
      <div class="arch-card contract" data-info="insurance-fund" style="border-color: #7b61ff;"><h4 style="color:#7b61ff;">InsuranceFund</h4><p>Bad debt backstop ¬∑ 5% coverage target</p><div class="fn">coverBadDebt() ¬∑ getHealthStatus()</div></div>
    </div>
  </div>

</div>

<!-- KEY RELATIONSHIPS -->
<div style="margin-top: 20px;">
  <h3 style="text-align:center; font-size:14px; color:#fff; margin-bottom: 14px;">Key Relationships</h3>
  <div class="info-grid" style="margin:0 auto;">
    <div class="info-card" style="border-color: rgba(0,212,255,0.2);">
      <h3 style="color:#00d4ff;">üìà Trade Flow</h3>
      <ul>
        <li><strong style="color:#ddd;">Trader</strong> ‚Üí MarginAccount ‚Üí Router ‚Üí PositionManager</li>
        <li>Router transfers USDC to <strong style="color:#ddd;">Vault</strong></li>
        <li>PositionManager reserves liquidity + records position</li>
        <li>FundingRate tracks OI skew per pair</li>
        <li>On close: PnL settled from Vault ‚Üí Trader</li>
      </ul>
    </div>
    <div class="info-card" style="border-color: rgba(255,68,102,0.2);">
      <h3 style="color:#ff4466;">üõ° Safety Chain</h3>
      <ul>
        <li><strong style="color:#ddd;">Keeper</strong> calls LiquidationEngine.liquidate()</li>
        <li>If underwater ‚Üí InsuranceFund.coverBadDebt()</li>
        <li>If fund empty ‚Üí AutoDeleverage force-closes profitable positions</li>
        <li>ADL triggers when vault utilization &gt; 90%</li>
        <li>Keeper earns 60% of liquidation penalty ($5 for ADL)</li>
      </ul>
    </div>
    <div class="info-card" style="border-color: rgba(123,97,255,0.2);">
      <h3 style="color:#7b61ff;">üí∞ Fee Flow</h3>
      <ul>
        <li>0.15% on open + 0.15% on close = <strong style="color:#ddd;">0.30% round-trip</strong></li>
        <li>Fees ‚Üí FeeDistributor ‚Üí 60/30/10 split</li>
        <li>30% back to Vault (LP yield via share appreciation)</li>
        <li>60% to Treasury (protocol revenue)</li>
        <li>10% to InsuranceFund (bad debt reserve)</li>
      </ul>
    </div>
    <div class="info-card" style="border-color: rgba(255,183,0,0.2);">
      <h3 style="color:#ffb700;">üîÆ Oracle Integration</h3>
      <ul>
        <li>Pyth pull-oracle ‚Äî user pays update fee with TX</li>
        <li>PriceAggregator wraps Pyth + mock fallback</li>
        <li>Used by: PositionManager, LiquidationEngine, OrderBook, ADL</li>
        <li>PairConfig sets leverage, OI caps, spread per pair</li>
        <li>Per-pair staleness check (configurable)</li>
      </ul>
    </div>
  </div>
</div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LIQUIDITY FLOW TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="diagram" id="liquidity">
<svg viewBox="0 0 1000 500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="a2" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#00d4ff"/></marker>
    <marker id="a3" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#00ff88"/></marker>
    <marker id="a4" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#ff4466"/></marker>
  </defs>

  <text x="500" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="700">USDC Liquidity Flow</text>

  <!-- LP Side -->
  <rect x="30" y="70" width="180" height="60" rx="10" fill="#0a1a2a" stroke="#00d4ff" stroke-width="2"/>
  <text x="120" y="97" text-anchor="middle" fill="#00d4ff" font-size="14" font-weight="600">üí∞ LP Provider</text>
  <text x="120" y="115" text-anchor="middle" fill="#666" font-size="10">Deposits USDC</text>

  <!-- Vault -->
  <rect x="350" y="170" width="300" height="80" rx="12" fill="#0a1a2a" stroke="#00d4ff" stroke-width="2.5" filter="url(#glow)"/>
  <text x="500" y="200" text-anchor="middle" fill="#00d4ff" font-size="18" font-weight="700">Vault (ERC4626)</text>
  <text x="500" y="220" text-anchor="middle" fill="#666" font-size="11">Liquidity Pool ¬∑ spVault Shares ¬∑ 15min Cooldown</text>
  <text x="500" y="238" text-anchor="middle" fill="#444" font-size="10">80% max utilization ¬∑ Reserve tracking</text>

  <!-- Trader Side -->
  <rect x="790" y="70" width="180" height="60" rx="10" fill="#0d2a1a" stroke="#00ff88" stroke-width="2"/>
  <text x="880" y="97" text-anchor="middle" fill="#00ff88" font-size="14" font-weight="600">ü¶ä Trader</text>
  <text x="880" y="115" text-anchor="middle" fill="#666" font-size="10">Collateral USDC</text>

  <!-- PositionManager -->
  <rect x="350" y="310" width="300" height="60" rx="10" fill="#0a1a2a" stroke="#00d4ff" stroke-width="1.5"/>
  <text x="500" y="338" text-anchor="middle" fill="#00d4ff" font-size="14" font-weight="600">PositionManager</text>
  <text x="500" y="355" text-anchor="middle" fill="#666" font-size="10">reserveLiquidity / releaseLiquidity / settlePnL</text>

  <!-- FeeDistributor -->
  <rect x="50" y="310" width="200" height="60" rx="10" fill="#1a1530" stroke="#7b61ff" stroke-width="1.5"/>
  <text x="150" y="338" text-anchor="middle" fill="#7b61ff" font-size="13" font-weight="600">FeeDistributor</text>
  <text x="150" y="355" text-anchor="middle" fill="#666" font-size="10">0.15% open + 0.15% close</text>

  <!-- Split boxes -->
  <rect x="30" y="420" width="100" height="45" rx="8" fill="#1a1530" stroke="#7b61ff"/>
  <text x="80" y="440" text-anchor="middle" fill="#7b61ff" font-size="11" font-weight="600">Vault 30%</text>
  <text x="80" y="455" text-anchor="middle" fill="#666" font-size="9">LP yield</text>

  <rect x="145" y="420" width="110" height="45" rx="8" fill="#111" stroke="#888"/>
  <text x="200" y="440" text-anchor="middle" fill="#ccc" font-size="11" font-weight="600">Treasury 60%</text>
  <text x="200" y="455" text-anchor="middle" fill="#666" font-size="9">Protocol rev</text>

  <rect x="270" y="420" width="120" height="45" rx="8" fill="#1a0a10" stroke="#ff4466"/>
  <text x="330" y="440" text-anchor="middle" fill="#ff4466" font-size="11" font-weight="600">Insurance 10%</text>
  <text x="330" y="455" text-anchor="middle" fill="#666" font-size="9">Bad debt fund</text>

  <!-- Arrows -->
  <!-- LP ‚Üí Vault -->
  <path d="M 120 130 L 120 200 L 350 200" stroke="#00d4ff" stroke-width="2" fill="none" marker-end="url(#a2)"/>
  <text x="200" y="190" fill="#00d4ff" font-size="10" font-weight="600">deposit(USDC)</text>
  <text x="200" y="205" fill="#666" font-size="9">receives spVault shares</text>

  <!-- Trader ‚Üí Vault (via Router) -->
  <path d="M 880 130 L 880 200 L 650 200" stroke="#00ff88" stroke-width="2" fill="none" marker-end="url(#a3)"/>
  <text x="760" y="190" fill="#00ff88" font-size="10" font-weight="600">collateral via Router</text>

  <!-- Vault ‚Üî PM -->
  <line x1="500" y1="250" x2="500" y2="310" stroke="#00d4ff" stroke-width="1.5" marker-end="url(#a2)"/>
  <text x="510" y="280" fill="#00d4ff" font-size="9">reserve/release</text>

  <!-- PM ‚Üí Vault (settle PnL) -->
  <path d="M 600 310 L 700 280 L 700 210 L 650 210" stroke="#00ff88" stroke-width="1.5" fill="none" marker-end="url(#a3)"/>
  <text x="720" y="260" fill="#00ff88" font-size="9">settlePnL</text>
  <text x="720" y="275" fill="#666" font-size="8">profit ‚Üí trader</text>

  <!-- PM ‚Üí FeeDistributor -->
  <line x1="350" y1="340" x2="250" y2="340" stroke="#7b61ff" stroke-width="1.5" marker-end="url(#a2)"/>
  <text x="300" y="332" fill="#7b61ff" font-size="9">fees</text>

  <!-- FeeDistributor ‚Üí splits -->
  <line x1="80" y1="370" x2="80" y2="420" stroke="#7b61ff" stroke-width="1"/>
  <line x1="150" y1="370" x2="200" y2="420" stroke="#888" stroke-width="1"/>
  <line x1="200" y1="370" x2="330" y2="420" stroke="#ff4466" stroke-width="1"/>
</svg>

<div class="info-grid">
  <div class="info-card">
    <h3 style="color:#00d4ff">LP Economics</h3>
    <ul>
      <li>Deposit USDC ‚Üí receive spVault shares (ERC4626)</li>
      <li>Earn 30% of all trading fees</li>
      <li>Counterparty to all trades (when traders lose, LPs gain)</li>
      <li>15-minute withdrawal cooldown</li>
      <li>80% max utilization protects withdrawal liquidity</li>
    </ul>
  </div>
  <div class="info-card">
    <h3 style="color:#00ff88">Trader Economics</h3>
    <ul>
      <li>0.15% fee on open + 0.15% fee on close (0.30% round-trip)</li>
      <li>Collateral locked in Vault during position</li>
      <li>Profit paid from Vault liquidity on close</li>
      <li>Losses stay in Vault (benefit LPs)</li>
      <li>Funding rate: longs ‚Üî shorts based on OI skew</li>
    </ul>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TRADING TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="diagram" id="trading">
<svg viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="a5" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#00ff88"/></marker>
    <marker id="a6" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#00d4ff"/></marker>
    <marker id="a7" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#ff4466"/></marker>
  </defs>

  <text x="500" y="30" text-anchor="middle" fill="#fff" font-size="16" font-weight="700">Trade Lifecycle ‚Äî Open Position</text>

  <!-- Steps -->
  <g>
    <rect x="50" y="60" width="180" height="50" rx="8" fill="#111" stroke="#555"/><text x="140" y="82" text-anchor="middle" fill="#ddd" font-size="12" font-weight="600">1. Trader signs TX</text><text x="140" y="98" text-anchor="middle" fill="#666" font-size="9">MetaMask / Session Key</text>
  </g>
  <line x1="230" y1="85" x2="280" y2="85" stroke="#00ff88" stroke-width="1.5" marker-end="url(#a5)"/>

  <g>
    <rect x="280" y="60" width="180" height="50" rx="8" fill="#0d2a1a" stroke="#00ff88"/><text x="370" y="82" text-anchor="middle" fill="#00ff88" font-size="12" font-weight="600">2. MarginAccount</text><text x="370" y="98" text-anchor="middle" fill="#666" font-size="9">Check balance, lock margin</text>
  </g>
  <line x1="460" y1="85" x2="510" y2="85" stroke="#00ff88" stroke-width="1.5" marker-end="url(#a5)"/>

  <g>
    <rect x="510" y="60" width="180" height="50" rx="8" fill="#1a1530" stroke="#7b61ff"/><text x="600" y="82" text-anchor="middle" fill="#7b61ff" font-size="12" font-weight="600">3. Router</text><text x="600" y="98" text-anchor="middle" fill="#666" font-size="9">Transfer USDC ‚Üí Vault</text>
  </g>
  <line x1="690" y1="85" x2="740" y2="85" stroke="#7b61ff" stroke-width="1.5" marker-end="url(#a6)"/>

  <g>
    <rect x="740" y="60" width="200" height="50" rx="8" fill="#1a1500" stroke="#ffb700"/><text x="840" y="82" text-anchor="middle" fill="#ffb700" font-size="12" font-weight="600">4. Update Pyth Price</text><text x="840" y="98" text-anchor="middle" fill="#666" font-size="9">priceUpdateData[]</text>
  </g>

  <!-- Second row -->
  <path d="M 840 110 L 840 150 L 140 150 L 140 180" stroke="#00d4ff" stroke-width="1.5" fill="none" marker-end="url(#a6)"/>

  <g>
    <rect x="50" y="180" width="200" height="50" rx="8" fill="#0a1a2a" stroke="#00d4ff"/><text x="150" y="202" text-anchor="middle" fill="#00d4ff" font-size="12" font-weight="600">5. PositionManager</text><text x="150" y="218" text-anchor="middle" fill="#666" font-size="9">Validate pair, leverage, OI</text>
  </g>
  <line x1="250" y1="205" x2="310" y2="205" stroke="#00d4ff" stroke-width="1.5" marker-end="url(#a6)"/>

  <g>
    <rect x="310" y="180" width="180" height="50" rx="8" fill="#0a1a2a" stroke="#00d4ff"/><text x="400" y="202" text-anchor="middle" fill="#00d4ff" font-size="12" font-weight="600">6. Apply Spread</text><text x="400" y="218" text-anchor="middle" fill="#666" font-size="9">Ask price for longs</text>
  </g>
  <line x1="490" y1="205" x2="540" y2="205" stroke="#00d4ff" stroke-width="1.5" marker-end="url(#a6)"/>

  <g>
    <rect x="540" y="180" width="180" height="50" rx="8" fill="#0a1a2a" stroke="#00d4ff"/><text x="630" y="202" text-anchor="middle" fill="#00d4ff" font-size="12" font-weight="600">7. Deduct Fee 0.15%</text><text x="630" y="218" text-anchor="middle" fill="#666" font-size="9">‚Üí FeeDistributor</text>
  </g>
  <line x1="720" y1="205" x2="770" y2="205" stroke="#00d4ff" stroke-width="1.5" marker-end="url(#a6)"/>

  <g>
    <rect x="770" y="180" width="180" height="50" rx="8" fill="#0a1a2a" stroke="#00d4ff"/><text x="860" y="202" text-anchor="middle" fill="#00d4ff" font-size="12" font-weight="600">8. Reserve Liquidity</text><text x="860" y="218" text-anchor="middle" fill="#666" font-size="9">Vault.reserveLiquidity()</text>
  </g>

  <path d="M 860 230 L 860 270 L 150 270 L 150 300" stroke="#00d4ff" stroke-width="1.5" fill="none" marker-end="url(#a6)"/>

  <g>
    <rect x="50" y="300" width="200" height="50" rx="8" fill="#0a1a2a" stroke="#00d4ff"/><text x="150" y="322" text-anchor="middle" fill="#00d4ff" font-size="12" font-weight="600">9. Update FundingRate</text><text x="150" y="338" text-anchor="middle" fill="#666" font-size="9">increaseOI(pairId, isLong, size)</text>
  </g>
  <line x1="250" y1="325" x2="310" y2="325" stroke="#00d4ff" stroke-width="1.5" marker-end="url(#a6)"/>

  <g>
    <rect x="310" y="300" width="200" height="50" rx="8" fill="#0a1a2a" stroke="#00d4ff" stroke-width="2"/><text x="410" y="322" text-anchor="middle" fill="#00d4ff" font-size="12" font-weight="700">10. Store Position ‚úÖ</text><text x="410" y="338" text-anchor="middle" fill="#666" font-size="9">positionId ‚Üí account, pair, size, entry</text>
  </g>

  <!-- Close flow -->
  <text x="500" y="400" text-anchor="middle" fill="#fff" font-size="16" font-weight="700">Close Position / Liquidation</text>

  <g><rect x="50" y="430" width="150" height="45" rx="8" fill="#0a1a2a" stroke="#00d4ff"/><text x="125" y="455" text-anchor="middle" fill="#00d4ff" font-size="11">Get current price</text></g>
  <line x1="200" y1="452" x2="230" y2="452" stroke="#00d4ff" stroke-width="1" marker-end="url(#a6)"/>

  <g><rect x="230" y="430" width="140" height="45" rx="8" fill="#0a1a2a" stroke="#00d4ff"/><text x="300" y="455" text-anchor="middle" fill="#00d4ff" font-size="11">Calculate PnL</text></g>
  <line x1="370" y1="452" x2="400" y2="452" stroke="#00d4ff" stroke-width="1" marker-end="url(#a6)"/>

  <g><rect x="400" y="430" width="150" height="45" rx="8" fill="#0a1a2a" stroke="#00d4ff"/><text x="475" y="455" text-anchor="middle" fill="#00d4ff" font-size="11">Apply funding</text></g>
  <line x1="550" y1="452" x2="580" y2="452" stroke="#00d4ff" stroke-width="1" marker-end="url(#a6)"/>

  <g><rect x="580" y="430" width="140" height="45" rx="8" fill="#7b61ff" stroke="#7b61ff" fill-opacity="0.15"/><text x="650" y="455" text-anchor="middle" fill="#7b61ff" font-size="11">Close fee 0.15%</text></g>
  <line x1="720" y1="452" x2="750" y2="452" stroke="#00d4ff" stroke-width="1" marker-end="url(#a6)"/>

  <g><rect x="750" y="430" width="200" height="45" rx="8" fill="#0d2a1a" stroke="#00ff88" stroke-width="2"/><text x="850" y="449" text-anchor="middle" fill="#00ff88" font-size="11" font-weight="600">Settle ‚Üí Trader</text><text x="850" y="465" text-anchor="middle" fill="#666" font-size="9">collateral + PnL - fees - funding</text></g>

  <!-- Liquidation branch -->
  <g><rect x="50" y="510" width="200" height="40" rx="8" fill="#1a0a10" stroke="#ff4466"/><text x="150" y="535" text-anchor="middle" fill="#ff4466" font-size="11">If underwater ‚Üí InsuranceFund</text></g>
  <line x1="250" y1="530" x2="310" y2="530" stroke="#ff4466" stroke-width="1" marker-end="url(#a7)"/>
  <g><rect x="310" y="510" width="200" height="40" rx="8" fill="#1a0a10" stroke="#ff4466"/><text x="410" y="535" text-anchor="middle" fill="#ff4466" font-size="11">If fund empty ‚Üí ADL</text></g>
  <line x1="510" y1="530" x2="570" y2="530" stroke="#ff4466" stroke-width="1" marker-end="url(#a7)"/>
  <g><rect x="570" y="510" width="200" height="40" rx="8" fill="#1a0a10" stroke="#ff4466"/><text x="670" y="535" text-anchor="middle" fill="#ff4466" font-size="11">Force-close profitable pos</text></g>
</svg>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAIRS TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="diagram" id="pairs">
  <h2 class="section-title">56 Trading Pairs</h2>
  <div class="pair-grid">
    <table>
      <thead><tr><th>ID</th><th>Pair</th><th>Category</th><th>Max Leverage</th><th>Spread</th></tr></thead>
      <tbody>
        <tr><td>1-7</td><td>EUR/USD, GBP/USD, USD/JPY, AUD/USD, NZD/USD, USD/CHF, USD/CAD</td><td><span class="cat-badge cat-fx">FX Major</span></td><td>200x</td><td>1-2 bps</td></tr>
        <tr><td>8-12</td><td>EUR/JPY, GBP/JPY, EUR/GBP, EUR/CHF, AUD/JPY</td><td><span class="cat-badge cat-fx">FX Cross</span></td><td>100x</td><td>3-5 bps</td></tr>
        <tr><td>13-19</td><td>USD/MXN, USD/SGD, USD/ZAR, USD/TRY, USD/NOK, USD/SEK, USD/COP</td><td><span class="cat-badge cat-fx">FX Exotic</span></td><td>50x</td><td>5-10 bps</td></tr>
        <tr><td>20-23</td><td>XAU/USD, XAG/USD, XPT/USD, XPD/USD</td><td><span class="cat-badge cat-metal">Metal</span></td><td>100x</td><td>3 bps</td></tr>
        <tr><td>24-25</td><td>WTI Crude, Brent Crude</td><td><span class="cat-badge cat-energy">Energy</span></td><td>50x</td><td>5 bps</td></tr>
        <tr><td>26-35</td><td>BTC, ETH, SOL, DOGE, AVAX, LINK, ARB, OP, AAVE, UNI</td><td><span class="cat-badge cat-crypto">Crypto</span></td><td>100-150x</td><td>3-5 bps</td></tr>
        <tr><td>36-50</td><td>AAPL, MSFT, AMZN, GOOGL, TSLA, NVDA, META, NFLX, AMD, COIN, GME, AMC, PLTR, MSTR, RIOT</td><td><span class="cat-badge cat-stock">US Stock</span></td><td>20x</td><td>5-10 bps</td></tr>
        <tr><td>51-54</td><td>SPY, QQQ, IWM, DIA</td><td><span class="cat-badge cat-index">Index ETF</span></td><td>50x</td><td>3 bps</td></tr>
        <tr><td>55</td><td>TLT (20yr Treasury)</td><td><span class="cat-badge cat-index">Bond ETF</span></td><td>30x</td><td>3 bps</td></tr>
        <tr><td>56</td><td>DXY (Dollar Index)</td><td><span class="cat-badge cat-index">Index</span></td><td>50x</td><td>3 bps</td></tr>
      </tbody>
    </table>
  </div>
  <div class="info-grid">
    <div class="info-card"><h3 style="color:#ffb700">Oracle: Pyth Network</h3><ul><li>Pull-based oracle ‚Äî user pays update fee</li><li>Sub-second price updates</li><li>Real Pyth feeds for all FX, metals, energy, crypto</li><li>Equity feeds via Pyth (AAPL, TSLA, etc.)</li><li>Staleness check per pair (configurable)</li><li>Mock mode fallback for testing</li></ul></div>
    <div class="info-card"><h3 style="color:#888">Risk Controls Per Pair</h3><ul><li>maxLeverage ‚Äî per asset class</li><li>maxOILong / maxOIShort ‚Äî OI caps</li><li>maxPositionSize ‚Äî single position limit</li><li>spreadBps ‚Äî bid/ask spread</li><li>borrowRatePerHour ‚Äî holding cost</li><li>Active/inactive toggle</li></ul></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FEES TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="diagram" id="fees">
  <h2 class="section-title">Fee Distribution Model</h2>
  <div class="fee-flow">
    <p style="text-align:center; color:#999; margin-bottom:20px; font-size:14px;">Every trade pays <strong style="color:#fff">0.15%</strong> on open + <strong style="color:#fff">0.15%</strong> on close = <strong style="color:#00d4ff">0.30% round-trip</strong></p>

    <div style="text-align:center; margin: 20px 0;">
      <svg viewBox="0 0 600 240" xmlns="http://www.w3.org/2000/svg" style="max-width:600px;">
        <rect x="200" y="10" width="200" height="40" rx="8" fill="#1a1530" stroke="#7b61ff"/>
        <text x="300" y="35" text-anchor="middle" fill="#7b61ff" font-size="14" font-weight="600">FeeDistributor</text>

        <line x1="230" y1="50" x2="100" y2="100" stroke="#7b61ff" stroke-width="2"/>
        <line x1="300" y1="50" x2="300" y2="100" stroke="#888" stroke-width="2"/>
        <line x1="370" y1="50" x2="500" y2="100" stroke="#ff4466" stroke-width="2"/>

        <rect x="20" y="100" width="160" height="55" rx="8" fill="#0a1a2a" stroke="#00d4ff"/>
        <text x="100" y="122" text-anchor="middle" fill="#00d4ff" font-size="13" font-weight="600">Vault (LPs)</text>
        <text x="100" y="142" text-anchor="middle" fill="#00d4ff" font-size="20" font-weight="700">30%</text>

        <rect x="220" y="100" width="160" height="55" rx="8" fill="#111" stroke="#888"/>
        <text x="300" y="122" text-anchor="middle" fill="#ccc" font-size="13" font-weight="600">Treasury</text>
        <text x="300" y="142" text-anchor="middle" fill="#ccc" font-size="20" font-weight="700">60%</text>

        <rect x="420" y="100" width="160" height="55" rx="8" fill="#1a0a10" stroke="#ff4466"/>
        <text x="500" y="122" text-anchor="middle" fill="#ff4466" font-size="13" font-weight="600">InsuranceFund</text>
        <text x="500" y="142" text-anchor="middle" fill="#ff4466" font-size="20" font-weight="700">10%</text>

        <text x="100" y="180" text-anchor="middle" fill="#666" font-size="10">LP yield / share</text>
        <text x="100" y="195" text-anchor="middle" fill="#666" font-size="10">value appreciation</text>
        <text x="300" y="180" text-anchor="middle" fill="#666" font-size="10">Protocol revenue</text>
        <text x="300" y="195" text-anchor="middle" fill="#666" font-size="10">Team / ops</text>
        <text x="500" y="180" text-anchor="middle" fill="#666" font-size="10">Bad debt backstop</text>
        <text x="500" y="195" text-anchor="middle" fill="#666" font-size="10">5% vault coverage target</text>
      </svg>
    </div>

    <div class="info-grid">
      <div class="info-card"><h3 style="color:#ff4466">Liquidation Penalties</h3><ul><li>5% of collateral as liquidation penalty</li><li>60% of penalty ‚Üí keeper bot reward</li><li>40% stays in protocol</li><li>Partial liquidation for positions &gt; $10K</li><li>1% maintenance margin threshold</li></ul></div>
      <div class="info-card"><h3 style="color:#00d4ff">Funding Rate</h3><ul><li>Max rate: 0.01% per hour</li><li>Rate = (longOI - shortOI) / totalOI √ó maxRate</li><li>Longs pay shorts when OI skewed long</li><li>Shorts pay longs when OI skewed short</li><li>Settled on position close (accrued continuously)</li></ul></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADDRESSES TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="diagram" id="addresses">
  <h2 class="section-title">Deployed Contract Addresses</h2>
  <p style="text-align:center; color:#666; margin-bottom:20px; font-size:13px;">Base Sepolia (Chain 84532) ‚Äî Testnet</p>
  <div class="info-grid">
    <div class="info-card">
      <h3 style="color:#00d4ff">Core</h3>
      <ul style="font-family: 'JetBrains Mono', monospace; font-size: 11px;">
        <li style="color:#aaa"><strong>USDC:</strong> 0x04f9...B215</li>
        <li style="color:#aaa"><strong>Vault:</strong> 0x07B2...71cf</li>
        <li style="color:#aaa"><strong>PositionManager:</strong> 0xcF1a...f28</li>
        <li style="color:#aaa"><strong>FundingRate:</strong> 0x8abF...5248</li>
      </ul>
    </div>
    <div class="info-card">
      <h3 style="color:#7b61ff">Periphery</h3>
      <ul style="font-family: 'JetBrains Mono', monospace; font-size: 11px;">
        <li style="color:#aaa"><strong>Router:</strong> 0x65b9...26B</li>
        <li style="color:#aaa"><strong>OrderBook:</strong> 0x509D...069</li>
        <li style="color:#aaa"><strong>FeeDistributor:</strong> 0xC904...25C</li>
        <li style="color:#aaa"><strong>SessionManager:</strong> 0x0800...2F6</li>
        <li style="color:#aaa"><strong>AccountFactory:</strong> 0xA25A...43a</li>
      </ul>
    </div>
    <div class="info-card">
      <h3 style="color:#ffb700">Oracle & Config</h3>
      <ul style="font-family: 'JetBrains Mono', monospace; font-size: 11px;">
        <li style="color:#aaa"><strong>PriceAggregator:</strong> 0x0586...43f</li>
        <li style="color:#aaa"><strong>PairConfig:</strong> 0xC624...906</li>
      </ul>
    </div>
    <div class="info-card">
      <h3 style="color:#ff4466">Safety</h3>
      <ul style="font-family: 'JetBrains Mono', monospace; font-size: 11px;">
        <li style="color:#aaa"><strong>LiquidationEngine:</strong> 0xDdf6...72F</li>
        <li style="color:#aaa"><strong>InsuranceFund:</strong> 0x4B04...9b</li>
        <li style="color:#aaa"><strong>AutoDeleverage:</strong> 0x56ee...664</li>
      </ul>
    </div>
  </div>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
function showTab(id) {
  document.querySelectorAll('.diagram').forEach(d => d.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  event.target.classList.add('active');
}

const contractInfo = {
  'router': { title: 'Router', color: '#7b61ff', desc: 'Primary entry point for trades. Handles USDC transfers, price updates, and session key resolution. Supports both direct trading and MarginAccount-delegated trading via *For() functions.', addr: '0x65b9161fEb229DFcD74D451d3705d0ed15aB426B' },
  'position-manager': { title: 'PositionManager', color: '#00d4ff', desc: 'Core trading engine. Opens/closes positions, calculates PnL, manages collateral, applies spreads, deducts fees, and coordinates with Vault and FundingRate. Only Router, LiquidationEngine, and ADL can call it.', addr: '0xcF1a6DB195df5c3f3A20D37D58Dc992550fAdF28' },
  'vault': { title: 'Vault (ERC4626)', color: '#00d4ff', desc: 'Liquidity pool for LPs. ERC4626 vault that issues spVault shares. Manages liquidity reservation (80% max util), PnL settlement, fee withdrawals, and 15-min withdrawal cooldown.', addr: '0x07B20E1370a10C8C107A5f8539F9419a927C71cf' },
  'funding-rate': { title: 'FundingRate', color: '#00d4ff', desc: 'Tracks long/short open interest per pair. Calculates continuous funding rate based on OI skew (max 0.01%/hr). Longs pay shorts when skewed long, and vice versa.', addr: '0x8abF46815673B12f44135a77930b3C04dB675248' },
  'oracle': { title: 'PriceAggregator', color: '#ffb700', desc: 'Wraps Pyth Network pull-oracle. Converts Pyth int64+expo to uint256. Supports mock mode for testing. Per-pair staleness checks. Feeds for FX, metals, energy, crypto, equities.', addr: '0x0586C57deaAf990Cae13C0e242C2a7412511343f' },
  'pair-config': { title: 'PairConfig', color: '#888', desc: '56 trading pairs with per-pair settings: max leverage, OI caps (long/short), max position size, spread, borrow rate, active toggle. Categories: FX, metals, energy, crypto, stocks, indices.', addr: '0xC624b6707adbf12302f4ec4A2060cF4c03B46906' },
  'liquidation': { title: 'LiquidationEngine', color: '#ff4466', desc: 'Monitors positions for liquidation (1% maintenance margin). Keepers call liquidate() and earn 60% of the 5% penalty. Handles bad debt via InsuranceFund, with ADL fallback.', addr: '0xDdf6678AB9aDa698BB61e347F3aDc408a18D872F' },
  'auto-deleverage': { title: 'AutoDeleverage', color: '#ff4466', desc: 'Last-resort vault protection. When utilization > 90%, keepers can force-close the most profitable positions to bring util back to 80%. $5 USDC keeper reward per ADL.', addr: '0x56ee753EEA683F23862172e8764759d164973664' },
  'insurance-fund': { title: 'InsuranceFund', color: '#7b61ff', desc: 'Bad debt backstop funded by 10% of trading fees. Covers losses when liquidated positions are underwater. 5% vault coverage target. Owner can withdraw excess. Triggers ADL if depleted.', addr: '0x4B04a4F0d06208D3849a9C307267B6E5AB37679b' },
  'fee-distributor': { title: 'FeeDistributor', color: '#7b61ff', desc: 'Collects all trading fees (0.15% open + close). Distributes: 60% to Treasury, 30% to Vault (LP yield), 10% to InsuranceFund.', addr: '0xC904B24dD25f5D56FE604F8017f82AE7a8D8325C' },
  'order-book': { title: 'OrderBook', color: '#7b61ff', desc: 'Limit order system. Users place orders with trigger prices. Keepers execute when price conditions are met. 30-day expiry. Supports Pyth price updates on execution.', addr: '0x509DF53b067c7FD05CEF2c4221e1fa9B1aBCE069' },
  'session-manager': { title: 'SessionManager', color: '#7b61ff', desc: 'Ephemeral key delegation for 1-click trading. Main wallet approves a browser-generated session key with expiry and spend cap. No MetaMask popups per trade.', addr: '0x0800f9a34fC7cAa3Eb8204Eb295E9Ee532EBE2F6' },
  'margin-account': { title: 'MarginAccount', color: '#00ff88', desc: 'Per-user on-chain wallet. Manages sub-accounts with separate balances, locked margin tracking, and position ownership. Session keys with per-trade and total exposure limits.', addr: 'Per-user (created by factory)' },
  'account-factory': { title: 'MarginAccountFactory', color: '#00ff88', desc: 'Deploys per-user MarginAccount instances. One account per address enforced. Router checks factory to verify MarginAccount callers.', addr: '0xA25A2E3b26295367f32a22f6C393A656e0dc143a' },
  'usdc': { title: 'USDC', color: '#00d4ff', desc: 'The sole collateral token. All deposits, margins, fees, and settlements are denominated in USDC (6 decimals).', addr: '0x04f9956819ACeD6f8941C6aEb3Fd6Fb120aDB215' },
};

document.querySelectorAll('.contract').forEach(el => {
  const key = el.dataset.info;
  if (!key || !contractInfo[key]) return;

  el.addEventListener('mouseenter', (e) => {
    const info = contractInfo[key];
    const tip = document.getElementById('tooltip');
    tip.innerHTML = `<h3 style="color:${info.color}">${info.title}</h3><p>${info.desc}</p><div class="addr">${info.addr}</div>`;
    tip.style.display = 'block';
    const r = el.getBoundingClientRect();
    tip.style.left = Math.min(r.left, window.innerWidth - 400) + 'px';
    tip.style.top = (r.bottom + 10) + 'px';
  });
  el.addEventListener('mouseleave', () => {
    document.getElementById('tooltip').style.display = 'none';
  });
});
</script>

</body>
</html>
